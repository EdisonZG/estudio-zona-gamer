<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Científica Completa</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    .calculadora { background: #222; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); width: 600px; transition: width 0.3s; }
    .pantalla { width: 100%; height: 40px; font-size: 22px; margin-bottom: 12px; background: #fff; border: none; border-radius: 6px; padding: 5px 10px; text-align: right; }
    .botones, .cientificos, .estadisticas { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin-bottom: 8px; }
    button { padding: 12px; font-size: 16px; background: #444; color: #fff; border: none; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
    button:hover { background: #666; }
    .igual { background: #e67e22; color: #fff; }
    .expandir { background: #18a2b8; margin-bottom: 8px; grid-column: span 6; }
    .inicio { background: #1abc9c; color: #fff; font-weight: bold; margin-bottom: 18px; width: 100%; border-radius: 6px; }
    .label { grid-column: span 6; color: #bbb; font-size: 14px; text-align: center; margin-bottom: 4px; }
    @media (max-width: 700px) { .calculadora { width: 98vw; } .botones, .cientificos, .estadisticas { grid-template-columns: repeat(4, 1fr);} }
  </style>
</head>
<body>
  <div id="calculadora" class="calculadora">
    <button class="inicio" onclick="location.href='index.html'">⟵ Inicio</button>
    <input type="text" id="pantalla" class="pantalla" placeholder="0" readonly>
    <button class="expandir" onclick="toggleCientifica()">Modo científico</button>
    <div class="label">Funciones científicas</div>
    <div id="cientificos" class="cientificos">
      <button onclick="funcion('abs')">abs</button>
      <button onclick="funcion('round')">round</button>
      <button onclick="funcion('floor')">floor</button>
      <button onclick="funcion('ceil')">ceil</button>
      <button onclick="funcion('inv')">1/x</button>
      <button onclick="funcion('neg')">+/-</button>
      <button onclick="potencia()">xʸ</button>
      <button onclick="funcion('exp')">eˣ</button>
      <button onclick="funcion('exp10')">10ˣ</button>
      <button onclick="funcion('sqrt')">√</button>
      <button onclick="funcion('cbrt')">∛</button>
      <button onclick="insertarConst('π')">π</button>
      <button onclick="insertarConst('e')">e</button>
      <button onclick="porcentaje()">%</button>
      <button onclick="factorial()">n!</button>
      <button onclick="funcion('log10')">log</button>
      <button onclick="funcion('ln')">ln</button>
      <button onclick="logBase()">logₐb</button>
      <button onclick="funcion('random')">rand</button>
      <button onclick="permutacion()">nPr</button>
      <button onclick="combinacion()">nCr</button>
    </div>
    <div class="label">Funciones estadísticas (usa una lista separada por comas)</div>
    <div class="estadisticas">
      <button onclick="estadistica('mean')">media</button>
      <button onclick="estadistica('median')">mediana</button>
      <button onclick="estadistica('mode')">moda</button>
      <button onclick="estadistica('stdev')">σ</button>
      <button onclick="estadistica('variance')">var</button>
      <button onclick="limpiar()">C</button>
    </div>
    <div class="label">Básicas</div>
    <div class="botones">
      <button onclick="agregar('7')">7</button>
      <button onclick="agregar('8')">8</button>
      <button onclick="agregar('9')">9</button>
      <button onclick="agregar('/')">÷</button>
      <button onclick="agregar('(')">(</button>
      <button onclick="agregar(')')">)</button>
      <button onclick="agregar('4')">4</button>
      <button onclick="agregar('5')">5</button>
      <button onclick="agregar('6')">6</button>
      <button onclick="agregar('*')">×</button>
      <button onclick="agregar(',')">,</button>
      <button onclick="borrarUno()">←</button>
      <button onclick="agregar('1')">1</button>
      <button onclick="agregar('2')">2</button>
      <button onclick="agregar('3')">3</button>
      <button onclick="agregar('-')">−</button>
      <button onclick="limpiar()">C</button>
      <button onclick="agregar('^')">^</button>
      <button onclick="agregar('0')">0</button>
      <button onclick="agregar('.')">.</button>
      <button onclick="calcular()" class="igual" style="grid-column: span 2;">=</button>
      <button onclick="agregar('+')">+</button>
    </div>
  </div>
  <script>
    let pantalla = document.getElementById('pantalla');
    let cientificos = document.getElementById('cientificos');
    let calculadora = document.getElementById('calculadora');
    let modoCientifico = true;

    function agregar(valor) { pantalla.value += valor; }
    function limpiar() { pantalla.value = ''; }
    function borrarUno() { pantalla.value = pantalla.value.slice(0, -1); }

    function parsearExpresion(expr) {
      return expr
        .replace(/π/g, "Math.PI")
        .replace(/e(?![a-zA-Z])/g, "Math.E")
        .replace(/(\d+(\.\d+)?|\w+)\s*\^\s*(\d+(\.\d+)?|\w+)/g, "Math.pow($1,$3)")
        .replace(/(\b|[^a-zA-Z0-9_])(log10|log|ln|sqrt|cbrt|abs|floor|ceil|round|exp|exp10)\s*\(/g, function(_, pre, fn){
          switch(fn){
            case "log": return pre+"Math.log10(";
            case "log10": return pre+"Math.log10(";
            case "ln": return pre+"Math.log(";
            case "sqrt": return pre+"Math.sqrt(";
            case "cbrt": return pre+"Math.cbrt(";
            case "abs": return pre+"Math.abs(";
            case "floor": return pre+"Math.floor(";
            case "ceil": return pre+"Math.ceil(";
            case "round": return pre+"Math.round(";
            case "exp": return pre+"Math.exp(";
            case "exp10": return pre+"Math.pow(10,";
          }
        })
        .replace(/(\d+(\.\d+)?)%/g, "($1/100)");
    }

    function calcular() {
      try {
        let expresion = parsearExpresion(pantalla.value);
        pantalla.value = eval(expresion);
      } catch {
        pantalla.value = "Error";
      }
    }

    function funcion(tipo) {
      let value = pantalla.value;
      let resultado = "";

      try {
        let arg = eval(parsearExpresion(value));
        switch (tipo) {
          case 'abs': resultado = Math.abs(arg); break;
          case 'round': resultado = Math.round(arg); break;
          case 'floor': resultado = Math.floor(arg); break;
          case 'ceil': resultado = Math.ceil(arg); break;
          case 'inv': resultado = 1 / arg; break;
          case 'neg': resultado = -arg; break;
          case 'exp': resultado = Math.exp(arg); break;
          case 'exp10': resultado = Math.pow(10, arg); break;
          case 'sqrt': resultado = Math.sqrt(arg); break;
          case 'cbrt': resultado = Math.cbrt(arg); break;
          case 'log10': resultado = Math.log10(arg); break;
          case 'ln': resultado = Math.log(arg); break;
          case 'random': resultado = Math.random(); break;
        }
        pantalla.value = resultado;
      } catch {
        pantalla.value = "Error";
      }
    }

    function potencia() { pantalla.value += "^"; }
    function insertarConst(c) { pantalla.value += c; }
    function porcentaje() {
      try {
        let value = eval(parsearExpresion(pantalla.value));
        pantalla.value = value / 100;
      } catch { pantalla.value = "Error"; }
    }

    function logBase() {
      let partes = pantalla.value.split(',');
      if (partes.length === 2) {
        let base = eval(parsearExpresion(partes[0]));
        let num = eval(parsearExpresion(partes[1]));
        if (base > 0 && base !== 1 && num > 0) {
          pantalla.value = (Math.log(num) / Math.log(base));
        } else {
          pantalla.value = "Error";
        }
      } else {
        pantalla.value = "Ej: base,numero";
      }
    }
    function factorial() {
      let value = pantalla.value;
      try {
        let num = Math.floor(eval(parsearExpresion(value)));
        if (num < 0 || isNaN(num)) throw Error();
        let res = 1;
        for (let i = 2; i <= num; i++) res *= i;
        pantalla.value = res.toString();
      } catch { pantalla.value = "Error"; }
    }

    function permutacion() {
      let partes = pantalla.value.split(',');
      if (partes.length === 2) {
        let n = parseInt(partes[0]);
        let r = parseInt(partes[1]);
        if (n >= r && n >= 0 && r >= 0) {
          pantalla.value = (factorialNum(n) / factorialNum(n - r)).toString();
        } else { pantalla.value = "Error"; }
      } else { pantalla.value = "Ej: n,r"; }
    }

    function combinacion() {
      let partes = pantalla.value.split(',');
      if (partes.length === 2) {
        let n = parseInt(partes[0]);
        let r = parseInt(partes[1]);
        if (n >= r && n >= 0 && r >= 0) {
          pantalla.value = (factorialNum(n) / (factorialNum(r) * factorialNum(n - r))).toString();
        } else { pantalla.value = "Error"; }
      } else { pantalla.value = "Ej: n,r"; }
    }

    function factorialNum(num) {
      if (num < 0 || isNaN(num)) return NaN;
      let res = 1;
      for (let i = 2; i <= num; i++) res *= i;
      return res;
    }

    function estadistica(tipo) {
      let lista = pantalla.value.split(',').map(x => parseFloat(x.trim()));
      switch (tipo) {
        case 'mean': pantalla.value = (lista.reduce((a, b) => a + b, 0) / lista.length).toString(); break;
        case 'median':
          lista.sort((a, b) => a - b);
          let mid = Math.floor(lista.length / 2);
          pantalla.value = (lista.length % 2 !== 0) ? lista[mid] : ((lista[mid - 1] + lista[mid]) / 2);
          break;
        case 'mode':
          let freq = {};
          lista.forEach(n => freq[n] = (freq[n] || 0) + 1);
          let max = Math.max(...Object.values(freq));
          let modos = Object.keys(freq).filter(k => freq[k] === max);
          pantalla.value = modos.join(',');
          break;
        case 'stdev':
          let mean = lista.reduce((a, b) => a + b, 0) / lista.length;
          let sq = lista.map(x => Math.pow(x - mean, 2));
          pantalla.value = Math.sqrt(sq.reduce((a, b) => a + b, 0) / lista.length);
          break;
        case 'variance':
          let avg = lista.reduce((a, b) => a + b, 0) / lista.length;
          let sq2 = lista.map(x => Math.pow(x - avg, 2));
          pantalla.value = (sq2.reduce((a, b) => a + b, 0) / lista.length);
          break;
      }
    }

    function toggleCientifica() {
      modoCientifico = !modoCientifico;
      if(modoCientifico) { cientificos.style.display = 'grid'; }
      else { cientificos.style.display = 'none'; }
    }
    window.onload = () => { cientificos.style.display = 'grid'; };
    pantalla.addEventListener('keydown', function(e) { if (e.key === 'Enter') { calcular(); } });
  </script>
</body>
</html>
